## Garbage Collection
GC란 JVM에서 자동으로 쓰레기를 치워주는 로봇 청소기라고 생각할 수 있다.  
여기서 표현한 "쓰레기"란 JVM의 힙 영역에 저장되어 있는 객체를 애플리케이션에서 더이상 사용되지 않는다고 판단하는 객체를 쓰레기라고 표현했다.  
C언어와 다르게 자바는 이러한 쓰레기 객체를 자동으로 제거해주기 때문에 개발자가 아주 편하게 개발할 수 있다. (C언어의 경우 직접 명시적으로 메모리를 해제 해줘야 한다는데 매우 귀찮았을 것 같다..)

**만일 이러한 쓰레기를 치워주지 않으면 어떤일이 발생할지 생각해보자.**  
자바의 객체는 힙 영역에 저장된다. 이러한 힙 영역은 당연하게도 한정된 공간을 할당 받았기 때문에 객체를 제거해주지 않으면 이 힙 영역이 가득차 애플리케이션이 멈춰버리는 현상이 발생할 것이다.  
우리는 이 현상을 OutOfMemory(OOM) 에러가 발생했다고 한다.  

OOM이 발생하지 않도록 힙 영역을 관리해주어야 하는데, 자바는 이를 자동으로 더 이상 사용하지 않는 객체는 제거해주니 매우 편하게 개발할 수 있다.

GC가 실행되면 "Stop-The-World" 라는 것이 발생하는데 이는 GC가 실행되면 GC를 실행하는 쓰레드를 제외한 모든 쓰레드가 멈추는 현상을 말한다.  
이러한 STW 시간을 줄이는것이 GC 성능 튜닝의 핵심이라고 한다.

## Heap 영역의 구조
### Young Generation (Young 영역)
- Eden 영역: 새로 생성된 객체가 최초로 할당되는 공간
  - Eden 영역이 가득차면 GC가 실행되고 (Minor GC라고 한다.), 살아남은 객체는 Survivor 영역으로 이동한다.
- Survivor 영역: Survivor 0, Survivor 1 두개의 영역으로 나뉘며, Eden 영역의 GC(Minor GC) 수행 후 살아남은 객체를 임시로 보관하는 공간
  - Survivor 영역이 가득차면 오래 살아남은 객체는 Old Generation 으로 이동한다.

### Old Generation (Old 영역)
- Young Generation에서 여러 번 살아남은(오래된) 객체들이 복사되어 저장되는 공간이다.
- Young Generation에서 살아남은 객체들이 저장되는 곳이기 때문에 더 큰 공간을 할당받는다.
  - 그래서 더 적게 GC가 발생하고 이떄 발생한 GC를 Major GC라고 부른다.

### 왜 Young Generation과 Old Generation 으로 나누어 관리할까?
대부분의 객체는 금방 필요 없어지는 경우가 많이 발생한다. (= unreachable 상태)  
그렇기 때문에 금방 사라질 객체는 Young 영역에 저장하며 빠르게 정리하고, 오래 살아남은 객체는 Old 영역에서 관리하는 것이다.

## GC 동작 과정
1. 객체가 생성되면 Eden 영역에 저장된다.
2. Minor GC 가 발생(더 이상 참조되지 않는 객체 제거)하면 Eden 영역과 Survivor 0 영역의 살아 있는 객체를 모두 Survivor 1 영역으로 복사한다.
3. 복사가 끝나면 Survivor 1 영역은 살아남은 객체로 채워지고, Survivor 0 영역은 비워진 상태로 유지된다.
4. 다음 Minor GC 가 발생하면 Survivor 0 영역이 살아남은 객체로 채워지고, Survivor 1 영역은 비워진 상태가 된다.
5. 이 과정을 반복하면서, GC 때마다 살아 있는 객체를 “비어 있는 Survivor 영역” 쪽으로 복사하다 오래 살아남은 객체는 Old 영역으로 복사된다.

## STW 현상이 발생하는 이유
GC가 발생하면 STW 현상이 발생하며 모든 쓰레드가 멈춘다고 배웠다.  
그럼 왜 GC 가 발생할 때 모든 쓰레드가 멈추고 GC를 실행할까?

GC는 더 이상 참조되지 않는 객체를 알아내야 하는데, 만일 애플리케이션이 멈추지 않고 객체 참조를 판단하게 되면 일관성이 깨지게 될 수 있다.  
그래서 GC가 힙 영역에 있는 객체를 제거해도 되는지 판단하기 위해 모든 쓰레드를 멈추고 제거할 객체를 찾는다.  

즉, 객체 참조 상태의 일관성을 확보하여, 안전하게 살아 있는 객체와 쓰레기를 구분하기 위해 STW 현상이 발생한다.

## Framing
TCP 소켓은 "바이트 스트림"만 제공하므로, 송신 측이 보낸 여러 메시지가 수신 측에서 어디서 끊어지는지 알 수 없다.  
따라서, 수신 측에서 메시지를 구분하기 위해서는 메시지의 시작과 끝을 알 수 있는 방법이 필요하다.  
이를 프레이밍(Framing)이라고 하며, 프레이밍을 통해 수신 측은 메시지를 구분할 수 있다.

즉, 프레이밍은 바이트 스트림에서 메시지 경계를 정해 주는 과정이다.

### 대표적인 프레이밍 방법
- 고정 길이 프레임(Fixed-length frame)
  - 각 메시지의 길이를 고정하여 송신 측에서 수신 측으로 전송한다. (매 메시지가 정확히 N 바이트)
  - 수신 측은 고정된 길이만큼 읽어들이면 메시지를 구분할 수 있다.
- 구분자 프레임(Delimiter frame)
  - 각 메시지의 끝에 구분자를 붙여 송신 측에서 수신 측으로 전송한다. (예: \n, \0 등)
  - 수신 측은 구분자를 기준으로 메시지를 구분할 수 있다. (\n, \0 등 특수 바이트가 나오면 끝)
  - 텍스트 프로토콜(HTTP/1 헤더)에서 흔함. 바이너리에선 구분자가 데이터 안에 섞일 위험 있음
-  Length-Prefixed Frame
  - 각 메시지의 시작 부분에 길이 필드를 붙여 송신 측에서 수신 측으로 전송한다.
  - 수신 측은 길이 필드를 읽어들인 후, 해당 길이만큼 메시지를 읽어들이면 메시지를 구분할 수 있다.
  - 데이터에 어떤 값이 오든 안전하다. 대부분의 바이너리 프로토콜이 채택

### Length-Prefixed Frame 형식

1. Frame 구성
```
+-----------+---------+-------------+
| Length(4) | Header  |  Payload    |
+-----------+---------+-------------+
```

- Length: 4바이트, 네트워크 바이트 오더로 `Header + Payload`의 길이
- 수신 측은 먼저 4바이트를 읽어 정수 L을 얻고, 이어서 L바이트를 더 읽어 한 프레임을 완성한다.

2. 동작 흐름
- 소켓에서 4 바이트를 읽어 길이를 파싱
- 버퍼에 length 만큼 데이터가 누적될 때까지 대기
- 원하는 길이가 모이면 프레임을 잘라 핸들러에 전달
